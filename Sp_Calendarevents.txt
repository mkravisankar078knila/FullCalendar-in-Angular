
ALTER PROCEDURE [dbo].[SP_CALENDAREVENTS]  
 @MODE				int=0,			 @ID			INT=0 ,     
 @TITLE			VARCHAR(30)='',    @STARTDATE			DATETIME='',
 @ENDDATE	DATETIME='',	 
 @ERR				INT=0 OUT
AS 

BEGIN TRAN  
  DECLARE @ERROR INT
  SET @ERROR=0  
  SET NOCOUNT ON  
  IF @MODE =0
	BEGIN  
		INSERT INTO CALENDAREVENTS(TITLE,STARTDATE,ENDDATE)  
		VALUES(@TITLE,@STARTDATE,@ENDDATE)  
    SET @ERROR=@@ERROR; IF @ERROR<>0 SET @ERR=@ERROR  
	END  
  ELSE IF @MODE =1
	BEGIN  
		UPDATE CALENDAREVENTS SET TITLE=@TITLE,STARTDATE=@STARTDATE, ENDDATE=@ENDDATE
                    		WHERE ID=@ID  
    SET @ERROR=@@ERROR; IF @ERROR<>0 SET @ERR=@ERROR  
	END  
  ELSE IF @MODE =2
	BEGIN  
		DELETE	FROM CALENDAREVENTS 	WHERE ID=@ID    
    SET @ERROR=@@ERROR; IF @ERROR<>0 SET @ERR=@ERROR  
	END  
  ELSE IF @MODE=3
	BEGIN  
		SELECT Id,Title,convert(varchar,format(startdate,'yyyy-MM-dd')) StartStr,
		convert(varchar,format(enddate,'yyyy-MM-dd')) EndStr FROM CALENDAREVENTS (NOLOCK) 
		
    SET @ERROR=@@ERROR; IF @ERROR<>0 SET @ERR=@ERROR  
	END      
  SET NOCOUNT OFF  
 IF @ERR<>0 ROLLBACK TRAN ELSE COMMIT TRAN  
  

